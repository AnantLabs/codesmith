
'------------------------------------------------------------------------------
' <autogenerated>
'     This code was generated by a CodeSmith Template.
'
'     DO NOT MODIfY contents of this file. Changes to this
'     file will be lost if the code is regenerated.
' </autogenerated>
'------------------------------------------------------------------------------

Imports System
Imports System.Data
Imports System.Data.Linq
Imports System.Data.Linq.Mapping
Imports System.Diagnostics
Imports CodeSmith.Data
Imports CodeSmith.Data.Rules
Imports Petshop.Data.Managers

Namespace Petshop.Data
    ''' <summary>
    ''' The DataContext manager class for the Petshop database.
    ''' </summary>
    Partial public Class PetshopDataContext
        
        Private _manager As PetshopDataManager = Nothing
        
        ''' <summary>
        ''' Gets the data manager.
        ''' </summary>
        ''' <value>The data manager.</value>
        Public ReadOnly Property Manager As PetshopDataManager
            Get
                If _manager Is Nothing Then
                    _manager = New PetshopDataManager(Me)
				End If
                Return _manager
            End Get
        End Property
        
        ''' <summary>
        ''' Sends changes made to retrieved objects to the underlying database.
        ''' </summary>
        ''' <param name="failureMode">How concurrency conflicts should be reported.</param>
        Public Overrides Sub SubmitChanges(ByVal failureMode As ConflictMode)
            Dim changes As ChangeSet = MyBase.GetChangeSet()
            Dim isValid As Boolean = Manager.Rules.Run(changes)
            
            If Not isValid
                Throw New BrokenRuleException(Manager.Rules.BrokenRules)
			End If
            
            MyBase.SubmitChanges(failureMode)
        End Sub
    End Class
End Namespace